<!-- Unified Main Navigation -->
<nav class="bg-stone-800 text-white shadow-lg sticky top-0 z-50" role="navigation" aria-label="Main navigation">
  <div class="max-w-7xl mx-auto">
    <!-- Top Bar: Domain Links & Auth -->
    <div class="bg-stone-900 border-b border-stone-700 container-padding py-2">
      <div class="flex flex-wrap items-center justify-between gap-2">
        <!-- Domain Links -->
        <ol class="inline-flex flex-wrap items-center gap-x-2 gap-y-1 text-stone-400" role="list">
          <li>
            <a href="https://coderic.co" class="nav-link-sm" 
              title="Coderic FinTech" aria-label="Visit Coderic FinTech">
              <svg class="nav-icon" fill="currentColor" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M6,16.5L3,19.44V11H6M11,14.66L9.43,13.32L8,14.64V7H11M16,13L13,16V3H16M18.81,12.81L17,11H22V16L20.21,14.21L13,21.36L9.53,18.34L5.75,22H3L9.47,15.66L13,18.64" />
              </svg>
              <span class="hidden sm:inline">FINTECH</span>
            </a>
          </li>
          <li aria-hidden="true" class="text-stone-600">·</li>
          <li>
            <a href="https://coderic.cloud" class="nav-link-sm"
              title="Coderic Cloud" aria-label="Visit Coderic Cloud">
              <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M12 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5 1.53.11c1.56.1 2.78 1.41 2.78 2.96 0 1.65-1.35 3-3 3H6c-2.21 0-4-1.79-4-4 0-2.05 1.53-3.76 3.56-3.97l1.07-.11.5-.95C8.08 7.14 9.94 6 12 6m0-2C9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96C18.67 6.59 15.64 4 12 4z" />
              </svg>
              <span class="hidden sm:inline">CLOUD</span>
            </a>
          </li>
          <li aria-hidden="true" class="text-stone-600">·</li>
          <li>
            <a href="https://coderic.net" class="nav-link-sm"
              title="Coderic Hub Content" aria-label="Visit Coderic Hub">
              <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <rect x="6" y="7" width="8" height="2" />
                <rect x="6" y="11" width="12" height="2" />
                <rect x="6" y="15" width="2.99" height="2" />
                <path d="M14,3,11,0V2H4A2,2,0,0,0,2,4V20a2,2,0,0,0,2,2H8V20H4V4h7V6Z" />
                <path d="M10,21l3,3V22h7a2,2,0,0,0,2-2V4a2,2,0,0,0-2-2H16V4h4V20H13V18Z" />
              </svg>
              <span class="hidden sm:inline">HUB</span>
            </a>
          </li>
          <li aria-hidden="true" class="text-stone-600">·</li>
          <li>
            <a href="https://coderic.org" class="nav-link-sm"
              title="Coderic Organization" aria-label="Visit Coderic Organization">
              <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M19,9A7,7,0,1,0,8.0257,14.75928L5,20l2.25562.09314L8.46411,22l3.46613-6.00354C11.95374,15.9967,11.97644,16,12,16s.04626-.0033.06976-.00354L15.53589,22l1.232-1.866L19,20l-3.02576-5.24072A6.98951,6.98951,0,0,0,19,9ZM7,9a5,5,0,1,1,5,5A5,5,0,0,1,7,9Z" />
                <circle cx="12" cy="9" r="3" />
              </svg>
              <span class="hidden sm:inline">ORGANIZATION</span>
            </a>
          </li>
        </ol>
        
        <!-- Auth Buttons -->
        <ol class="inline-flex items-center gap-2" role="list">
          <li class="guest hidden">
            <a class="nav-link-md" 
              href="/" title="Sign in" aria-label="Sign in to Coderic" onclick="if(typeof login === 'function') { login(); return false; }">
              <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" aria-hidden="true">
                <path d="M26,30H14a2,2,0,0,1-2-2V25h2v3H26V4H14V7H12V4a2,2,0,0,1,2-2H26a2,2,0,0,1,2,2V28A2,2,0,0,1,26,30Z" />
                <polygon points="14.59 20.59 18.17 17 4 17 4 15 18.17 15 14.59 11.41 16 10 22 16 16 22 14.59 20.59" />
              </svg>
              <span class="hidden sm:inline">Sign in</span>
            </a>
          </li>
          <li class="authenticated hidden">
            <a href="/profile" class="nav-link-md" 
              title="Profile" aria-label="View profile">
              <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" aria-hidden="true">
                <path d="M16,8a5,5,0,1,0,5,5A5,5,0,0,0,16,8Zm0,8a3,3,0,1,1,3-3A3.0034,3.0034,0,0,1,16,16Z" />
                <path d="M16,2A14,14,0,1,0,30,16,14.0158,14.0158,0,0,0,16,2ZM10,26.3765V25a3.0033,3.0033,0,0,1,3-3h6a3.0033,3.0033,0,0,1,3,3v1.3765a11.8989,11.8989,0,0,1-12,0Zm13.9925-1.4507A5.0016,5.0016,0,0,0,19,20H13a5.0016,5.0016,0,0,0-4.9925,4.9258,12,12,0,1,1,15.985,0Z" />
              </svg>
              <span class="hidden sm:inline" id="username"></span>
            </a>
          </li>
          <li class="authenticated hidden">
            <a href="/dashboard" class="nav-link-md"
              title="Dashboard" aria-label="View dashboard">
              <svg class="nav-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="currentColor" aria-hidden="true">
                <rect x="24" y="21" width="2" height="5" />
                <rect x="20" y="16" width="2" height="10" />
                <path d="M11,26a5.0059,5.0059,0,0,1-5-5H8a3,3,0,1,0,3-3V16a5,5,0,0,1,0,10Z" />
                <path d="M28,2H4A2.002,2.002,0,0,0,2,4V28a2.0023,2.0023,0,0,0,2,2H28a2.0027,2.0027,0,0,0,2-2V4A2.0023,2.0023,0,0,0,28,2Zm0,9H14V4H28ZM12,4v7H4V4ZM4,28V13H28.0007l.0013,15Z" />
              </svg>
              <span class="hidden sm:inline">Dashboard</span>
            </a>
          </li>
          <li class="authenticated hidden">
            <button type="button" onclick="if(typeof logout === 'function') { logout(); return false; }" 
              class="nav-link-md"
              aria-label="Sign out">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="nav-icon" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
              </svg>
              <span class="hidden sm:inline">Sign out</span>
            </button>
          </li>
        </ol>
      </div>
    </div>

    <!-- Main Menu Bar -->
    <div class="container-padding">
      <div class="flex items-center justify-between">
        <!-- Mobile menu button -->
        <button
          class="lg:hidden py-3 px-2 text-white hover:bg-stone-700 focus:outline-none focus:ring-2 focus:ring-orange-500 rounded-md transition-colors"
          type="button"
          aria-expanded="false"
          aria-controls="main-menu"
          aria-label="Toggle navigation menu"
          id="mobile-menu-button">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="nav-icon-lg" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
          </svg>
        </button>
        
        <!-- Desktop Navigation -->
        <ul class="hidden lg:flex flex-row items-center" role="menubar" id="main-menu-desktop">
          {% assign nav_items = "development,crowdfunding,coworking,freelancers,learning,community,organization" | split: "," %}
          {% for item in nav_items %}
          <li role="none">
            <a class="nav-menu-item" 
              href="/{{ item }}" 
              role="menuitem"
              aria-label="{{ item | capitalize }}">
              {{ item | upcase | replace: "-", "-" }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
      
      <!-- Mobile Navigation (hidden by default) -->
      <ul class="lg:hidden hidden flex-col w-full absolute left-0 bg-stone-800 shadow-lg z-50 border-t border-stone-700" id="mobile-menu" role="menu">
        {% for item in nav_items %}
        <li role="none">
          <a class="nav-menu-item-mobile" 
            href="/{{ item }}" 
            role="menuitem"
            aria-label="{{ item | capitalize }}">
            {{ item | upcase | replace: "-", "-" }}
          </a>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
</nav>

{% if page.title %}
<header class="bg-white border-b border-stone-200" role="banner">
  <div class="max-w-7xl mx-auto container-padding py-4">
    <h1 class="heading-3 text-gray-900">
      {{ page.title }}
    </h1>
  </div>
</header>
{% endif %}

<script>
  // Mobile menu toggle with better practices
  (function() {
    'use strict';
    
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    
    if (!mobileMenuButton || !mobileMenu) return;
    
    const toggleMenu = () => {
      const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
      mobileMenu.classList.toggle('hidden');
      mobileMenuButton.setAttribute('aria-expanded', String(!isExpanded));
      
      // Update icon
      const icon = mobileMenuButton.querySelector('svg path');
      if (icon) {
        icon.setAttribute('d', isExpanded 
          ? 'M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5'
          : 'M6 18L18 6M6 6l12 12'
        );
        icon.setAttribute('stroke-linecap', 'round');
        icon.setAttribute('stroke-linejoin', 'round');
      }
    };
    
    const closeMenu = () => {
      if (!mobileMenu.classList.contains('hidden')) {
        mobileMenu.classList.add('hidden');
        mobileMenuButton.setAttribute('aria-expanded', 'false');
        const icon = mobileMenuButton.querySelector('svg path');
        if (icon) {
          icon.setAttribute('d', 'M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5');
        }
      }
    };
    
    mobileMenuButton.addEventListener('click', toggleMenu);
    
    // Close menu when clicking outside or pressing Escape
    document.addEventListener('click', (e) => {
      if (!mobileMenuButton.contains(e.target) && !mobileMenu.contains(e.target)) {
        closeMenu();
      }
    });
    
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeMenu();
      }
    });
  })();
</script>
